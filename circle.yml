machine:
  xcode:
    version: "9.0"
dependencies:
  pre:
    - brew update || brew update
    - brew install swiftlint
    - system_profiler SPSoftwareDataType
    - security list-keychains
    - security find-identity -p codesigning
    - instruments -s devices
    - xcodebuild -showsdks
  override:
    - git submodule sync --recursive
    - git submodule update --init --recursive
test:
  pre:
    - xcrun instruments -w 'iPhone 7 (10.2)' || true
    - sleep 15
  override:
    - set -o pipefail &&
      swiftlint lint --strict --reporter json |
      tee $CIRCLE_ARTIFACTS/swiftlint-report.json
    - bin/test iOS 10.2
    - bin/test iOS 11.0
experimental:
  notify:
    branches:
      only:
        - master
